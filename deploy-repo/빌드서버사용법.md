네! ECR 레포지토리가 이미 있으니 그 부분 빼고 정리해드릴게요:

## 1. **EC2 인스턴스 생성** (AWS 콘솔)
- Ubuntu 22.04 LTS 선택
- 인스턴스 타입: t3.medium 이상 권장
- 보안 그룹: SSH(22) 포트 오픈
- 키페어 생성 및 다운로드

## 2. **서버 접속**
```bash
ssh -i your-key.pem ubuntu@[서버-공인-IP]
```

## 3. **시스템 업데이트**
```bash
sudo apt update && sudo apt upgrade -y
```

## 4. **Docker 설치**
```bash
# Docker 설치
sudo apt install -y docker.io

# Docker 서비스 시작
sudo systemctl start docker
sudo systemctl enable docker

# 현재 사용자를 docker 그룹에 추가
sudo usermod -aG docker $USER

# 재로그인 (권한 적용)
exit
# 다시 ssh 접속
```

## 5. **AWS CLI 설치**
```bash
sudo apt install -y unzip curl

curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install

# 설치 확인
aws --version
```

## 6. **AWS 자격 증명 설정**
```bash
aws configure
```
입력 항목:
- AWS Access Key ID: [발급받은 키]
- AWS Secret Access Key: [발급받은 시크릿]
- Default region name: ap-northeast-2
- Default output format: json

## 7. **Git 설치 및 코드 Clone**
```bash
sudo apt install -y git

git clone https://github.com/your-repo/your-project.git
cd your-project
```

## 8. **ECR 로그인**
```bash
aws ecr get-login-password --region ap-northeast-2 | \
docker login --username AWS --password-stdin \
152864141231.dkr.ecr.ap-northeast-2.amazonaws.com
```

## 9. **Docker 이미지 빌드**
```bash
docker build -t weather-airflow:latest .
```

## 10. **이미지 태그 지정**
```bash
docker tag weather-airflow:latest \
152864141231.dkr.ecr.ap-northeast-2.amazonaws.com/weather-airflow:latest
```

## 11. **ECR에 푸시**
```bash
docker push \
152864141231.dkr.ecr.ap-northeast-2.amazonaws.com/weather-airflow:latest
```

## 전체 자동화 스크립트
```bash
#!/bin/bash

# 처음 서버 세팅 시 한번만 실행
setup_server() {
  sudo apt update && sudo apt upgrade -y
  
  # Docker 설치
  sudo apt install -y docker.io
  sudo systemctl start docker
  sudo systemctl enable docker
  sudo usermod -aG docker $USER
  
  # AWS CLI 설치
  sudo apt install -y unzip curl
  curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
  unzip awscliv2.zip
  sudo ./aws/install
  
  # Git 설치
  sudo apt install -y git
  
  echo "✅ 서버 세팅 완료! 재로그인 후 aws configure 실행하세요"
}

# 빌드 & 푸시 (매번 실행)
build_and_push() {
  ECR_URL="152864141231.dkr.ecr.ap-northeast-2.amazonaws.com"
  REPO_NAME="weather-airflow"
  IMAGE_TAG="latest"
  
  # ECR 로그인
  aws ecr get-login-password --region ap-northeast-2 | \
  docker login --username AWS --password-stdin $ECR_URL
  
  # 빌드
  docker build -t $REPO_NAME:$IMAGE_TAG .
  
  # 태그
  docker tag $REPO_NAME:$IMAGE_TAG $ECR_URL/$REPO_NAME:$IMAGE_TAG
  
  # 푸시
  docker push $ECR_URL/$REPO_NAME:$IMAGE_TAG
  
  echo "✅ 푸시 완료!"
}

# 사용법
# 처음: setup_server
# 이후: build_and_push
```

