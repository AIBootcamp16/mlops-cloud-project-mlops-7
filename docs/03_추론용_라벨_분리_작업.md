# ì¶”ë¡ ìš© ë°ì´í„°ì—ì„œ ì •ë‹µ ë¼ë²¨(comfort_score) ì œê±° ì‘ì—…

## ğŸ“‹ ì‘ì—… ê°œìš”

ì‹¤ì‹œê°„ ì¶”ë¡ ìš© ë°ì´í„°ì— **ì •ë‹µ ë¼ë²¨(comfort_score)**ì´ í¬í•¨ë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì¶”ë¡ ìš©ê³¼ í•™ìŠµìš© ë°ì´í„°ì…‹ì„ ëª…í™•íˆ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤.

## ğŸš¨ ë¬¸ì œ ìƒí™©

### ë°œê²¬ëœ ì´ìŠˆ
- **ì‹¤ì‹œê°„ S3 ì ì¬**: ì¶”ë¡ ìš© ë°ì´í„°ì—ë„ `comfort_score` í¬í•¨
- **ë…¼ë¦¬ì  ëª¨ìˆœ**: ì‹¤ì‹œê°„ ì¶”ë¡  ì‹œì—ëŠ” ì •ë‹µì„ ì•Œ ìˆ˜ ì—†ìŒ
- **ë°ì´í„° ì˜¤ì—¼**: ì¶”ë¡ ìš© ë°ì´í„°ì— ì •ë‹µì´ í¬í•¨ë˜ì–´ ë¶€ì •í™•í•œ í‰ê°€ ê°€ëŠ¥

### ë¬¸ì œ ì˜í–¥
```python
# âŒ ì˜ëª»ëœ ìƒí™©
ì‹¤ì‹œê°„ ë°ì´í„° â†’ ML ë°ì´í„°ì…‹ ìƒì„± â†’ comfort_score í¬í•¨ â†’ S3 ì €ì¥
                                    â†‘
                              ì‹¤ì œë¡œëŠ” ì•Œ ìˆ˜ ì—†ëŠ” ì •ë‹µ
```

## ğŸ”§ í•´ê²° ë°©ì•ˆ

### í•µì‹¬ ì•„ì´ë””ì–´: ì¡°ê±´ë¶€ ë¼ë²¨ í¬í•¨
- **ì¶”ë¡ ìš© ë°ì´í„°**: `include_labels=False` â†’ comfort_score ì œì™¸
- **í•™ìŠµìš© ë°ì´í„°**: `include_labels=True` â†’ comfort_score í¬í•¨

## ğŸ“ êµ¬í˜„ ìƒì„¸

### 1. Feature Builder ìˆ˜ì •

**íŒŒì¼**: `src/features/feature_builder.py`

**í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½**:
```python
# Before
def create_ml_dataset(raw_data: Dict[str, Any]) -> pd.DataFrame:

# After
def create_ml_dataset(raw_data: Dict[str, Any], include_labels: bool = False) -> pd.DataFrame:
    """
    Args:
        raw_data: ì›ì‹œ ê¸°ìƒ ë°ì´í„°
        include_labels: Trueë©´ comfort_score(ì •ë‹µ) í¬í•¨, Falseë©´ ì¶”ë¡ ìš©
    """
```

**ì¡°ê±´ë¶€ ë¼ë²¨ ìƒì„±**:
```python
def add_engineered_features(df: pd.DataFrame, include_labels: bool = False) -> pd.DataFrame:
    # ... ê¸°ë³¸ í”¼ì²˜ ìƒì„± ...

    # 5. ì¢…í•© ì¾Œì ì§€ìˆ˜ ê³„ì‚° (í•™ìŠµìš©ë§Œ)
    if include_labels:
        df['comfort_score'] = calculate_comfort_score(df)
        # í•™ìŠµìš©: comfort_score í¬í•¨
    # else: ì¶”ë¡ ìš©ì€ comfort_score ìƒì„±í•˜ì§€ ì•ŠìŒ

    return df
```

### 2. ì‹¤ì‹œê°„ ì²˜ë¦¬ ë¡œì§ ìˆ˜ì •

**íŒŒì¼**: `src/data/weather_processor.py`

**ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬ (ì¶”ë¡ ìš©)**:
```python
def process_and_store_weather_data(self, ...):
    # ...
    if parsed_asos or parsed_pm10:
        raw_data = {"asos": parsed_asos, "pm10": parsed_pm10}
        ml_dataset = create_ml_dataset(raw_data, include_labels=False)  # ì‹¤ì‹œê°„ ì¶”ë¡ ìš©: ì •ë‹µ ì œì™¸
        #                                            â†‘
        #                                    í•µì‹¬: Falseë¡œ ì„¤ì •
```

**Rolling Window ì—…ë°ì´íŠ¸ (í•™ìŠµìš©)**:
```python
def update_master_training_dataset(self, ...):
    # ...
    if raw_data_for_ml:
        ml_dataset = create_ml_dataset(raw_data_for_ml, include_labels=True)  # í•™ìŠµìš©: ì •ë‹µ í¬í•¨
        #                                               â†‘
        #                                       í•µì‹¬: Trueë¡œ ì„¤ì •
```

### 3. S3 ì €ì¥ ë©”ì„œë“œ í™•ì¥

**íŒŒì¼**: `src/storage/s3_client.py`

**key_suffix ì§€ì› ì¶”ê°€**:
```python
def save_ml_dataset(self, df: pd.DataFrame, timestamp: datetime, key_suffix: str = None) -> str:
    """ML ë°ì´í„°ì…‹ ì €ì¥"""
    if key_suffix:
        key = f"ml_dataset/{date_str}/dataset_{time_str}_{key_suffix}.parquet"
        #                                                    â†‘
        #                                        í•™ìŠµìš©: training_master ì¶”ê°€
    else:
        key = f"ml_dataset/{date_str}/dataset_{time_str}.parquet"
        #                                       â†‘
        #                               ì¶”ë¡ ìš©: ê¸°ë³¸ íŒŒì¼ëª…
```

## ğŸ“Š ë°ì´í„° êµ¬ì¡° ë³€í™”

### S3 ì €ì¥ êµ¬ì¡°

**Before (ì˜ëª»ëœ ìƒí™©)**:
```
ml_dataset/2025/09/26/
â””â”€â”€ dataset_150000.parquet
    â”œâ”€â”€ station_id: 108
    â”œâ”€â”€ datetime: 2025-09-26 15:00:00
    â”œâ”€â”€ temperature: 22.5
    â”œâ”€â”€ pm10: 35.0
    â”œâ”€â”€ [30ê°œ í”¼ì²˜ë“¤...]
    â””â”€â”€ comfort_score: 75.2  âŒ ì¶”ë¡  ì‹œì—ëŠ” ì•Œ ìˆ˜ ì—†ëŠ” ì •ë‹µ
```

**After (ì˜¬ë°”ë¥¸ ìƒí™©)**:
```
ml_dataset/2025/09/26/
â”œâ”€â”€ dataset_150000.parquet                     # ì¶”ë¡ ìš©
â”‚   â”œâ”€â”€ station_id: 108
â”‚   â”œâ”€â”€ datetime: 2025-09-26 15:00:00
â”‚   â”œâ”€â”€ temperature: 22.5
â”‚   â”œâ”€â”€ pm10: 35.0
â”‚   â””â”€â”€ [30ê°œ í”¼ì²˜ë“¤...]                       # comfort_score ì—†ìŒ âœ…
â”‚
â””â”€â”€ dataset_150000_training_master.parquet     # í•™ìŠµìš© (Rolling Window)
    â”œâ”€â”€ station_id: 108
    â”œâ”€â”€ datetime: 2025-09-26 15:00:00
    â”œâ”€â”€ temperature: 22.5
    â”œâ”€â”€ pm10: 35.0
    â”œâ”€â”€ [30ê°œ í”¼ì²˜ë“¤...]
    â””â”€â”€ comfort_score: 75.2                    # ì •ë‹µ í¬í•¨ âœ…
```

### ìš©ë„ë³„ ë°ì´í„° ë¶„ë¥˜

| ë°ì´í„° íƒ€ì… | include_labels | comfort_score | ìš©ë„ | íŒŒì¼ëª… íŒ¨í„´ |
|------------|----------------|---------------|------|-------------|
| **ì‹¤ì‹œê°„ ì¶”ë¡ ìš©** | `False` | âŒ ì—†ìŒ | ëª¨ë¸ ì¶”ë¡  | `dataset_HHMMSS.parquet` |
| **í•™ìŠµìš© ë§ˆìŠ¤í„°** | `True` | âœ… í¬í•¨ | ëª¨ë¸ í•™ìŠµ/ê²€ì¦ | `dataset_HHMMSS_training_master.parquet` |

## ğŸ”„ ë°ì´í„° í”Œë¡œìš° ê°œì„ 

### Before (ë¬¸ì œ ìƒí™©)
```
ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘
    â†“
ML ë°ì´í„°ì…‹ ìƒì„± (comfort_score í¬í•¨) âŒ
    â†“
S3 ì €ì¥ (ì¶”ë¡ ìš©ì¸ë° ì •ë‹µ í¬í•¨) âŒ
```

### After (í•´ê²°ëœ ìƒí™©)
```
ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘
    â†“
â”Œâ”€ ì‹¤ì‹œê°„ ML ë°ì´í„°ì…‹ (include_labels=False) âœ…
â”‚   â””â”€ S3 ì €ì¥ (ì¶”ë¡ ìš©, comfort_score ì—†ìŒ)
â”‚
â””â”€ Rolling Window ì—…ë°ì´íŠ¸
    â””â”€ í•™ìŠµìš© ML ë°ì´í„°ì…‹ (include_labels=True) âœ…
        â””â”€ S3 ì €ì¥ (í•™ìŠµìš©, comfort_score í¬í•¨)
```

## ğŸ’¡ ì„¤ê³„ ì›ì¹™

### 1. ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬
- **ì‹¤ì‹œê°„ ì¶”ë¡ **: ì•Œê³  ìˆëŠ” ê¸°ìƒ ë°ì´í„°ë§Œìœ¼ë¡œ ì˜ˆì¸¡
- **ëª¨ë¸ í•™ìŠµ**: ê³¼ê±° ë°ì´í„°ì˜ ì‹¤ì œ ì¾Œì ì§€ìˆ˜ë¡œ í•™ìŠµ

### 2. ë°ì´í„° ë¬´ê²°ì„±
- **ì¶”ë¡  ì‹œì **: comfort_scoreëŠ” ì•„ì§ ì•Œ ìˆ˜ ì—†ëŠ” ë¯¸ë˜ ê°’
- **í•™ìŠµ ì‹œì **: comfort_scoreëŠ” ì´ë¯¸ ê´€ì¸¡ëœ ê³¼ê±° ê°’

### 3. ë…¼ë¦¬ì  ì¼ê´€ì„±
```python
# âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš©ë²•
# ì‹¤ì‹œê°„ ì¶”ë¡  (15:00ì— ì‹¤í–‰)
features = create_ml_dataset(current_weather, include_labels=False)  # 15:00ì˜ ì¾Œì ì§€ìˆ˜ëŠ” ì•„ì§ ëª¨ë¦„
prediction = model.predict(features)  # ëª¨ë¸ì´ ì˜ˆì¸¡

# í•™ìŠµ (ê³¼ê±° ë°ì´í„°ë¡œ)
features = create_ml_dataset(historical_weather, include_labels=True)  # ê³¼ê±°ì˜ ì¾Œì ì§€ìˆ˜ëŠ” ì´ë¯¸ ê´€ì¸¡ë¨
model.train(features)  # ì‹¤ì œ ê°’ìœ¼ë¡œ í•™ìŠµ
```

## âœ… ê²€ì¦ ê²°ê³¼

### 1. ì¶”ë¡ ìš© ë°ì´í„° ê²€ì¦
```python
# ì‹¤ì‹œê°„ ë°ì´í„°ì…‹ ìƒì„± í…ŒìŠ¤íŠ¸
ml_dataset = create_ml_dataset(raw_data, include_labels=False)
assert 'comfort_score' not in ml_dataset.columns  # âœ… í†µê³¼
```

### 2. í•™ìŠµìš© ë°ì´í„° ê²€ì¦
```python
# í•™ìŠµìš© ë°ì´í„°ì…‹ ìƒì„± í…ŒìŠ¤íŠ¸
ml_dataset = create_ml_dataset(raw_data, include_labels=True)
assert 'comfort_score' in ml_dataset.columns  # âœ… í†µê³¼
```

### 3. íŒŒì¼ êµ¬ì¡° ê²€ì¦
```
S3 ë²„í‚· í™•ì¸:
âœ… dataset_150000.parquet (ì¶”ë¡ ìš©) - comfort_score ì—†ìŒ
âœ… dataset_150000_training_master.parquet (í•™ìŠµìš©) - comfort_score í¬í•¨
```

## ğŸ“ˆ ì„±ëŠ¥ ë° í’ˆì§ˆ ì˜í–¥

### 1. ë°ì´í„° í’ˆì§ˆ í–¥ìƒ
- **ë…¼ë¦¬ì  ì¼ê´€ì„±**: ì¶”ë¡  ì‹œì—ëŠ” ì •ë‹µì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- **í‰ê°€ ì •í™•ì„±**: ëª¨ë¸ ì„±ëŠ¥ í‰ê°€ ì‹œ ë°ì´í„° ì˜¤ì—¼ ë°©ì§€
- **ì‹¤ì œ ìš´ì˜ ë°˜ì˜**: ì‹¤ì œ ë°°í¬ í™˜ê²½ê³¼ ë™ì¼í•œ ì¡°ê±´

### 2. ìŠ¤í† ë¦¬ì§€ íš¨ìœ¨ì„±
- **ì¶”ë¡ ìš©**: comfort_score ì—†ì–´ì„œ ì•½ê°„ ê²½ëŸ‰í™”
- **í•™ìŠµìš©**: Rolling Windowë¡œ ìƒì„±ë˜ë¯€ë¡œ ì¶”ê°€ ë¶€ë‹´ ì—†ìŒ

### 3. ìš´ì˜ ì•ˆì •ì„±
- **ëª…í™•í•œ êµ¬ë¶„**: ì¶”ë¡ ìš©/í•™ìŠµìš© ë°ì´í„° ëª…í™•íˆ ë¶„ë¦¬
- **ì‹¤ìˆ˜ ë°©ì§€**: include_labels í”Œë˜ê·¸ë¡œ ì˜ë„ ëª…ì‹œ
- **í™•ì¥ì„±**: í–¥í›„ ë‹¤ë¥¸ ë¼ë²¨ ì¶”ê°€ ì‹œì—ë„ ë™ì¼ íŒ¨í„´ ì ìš© ê°€ëŠ¥

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • í•„ìš”
```python
# âŒ ê¸°ì¡´ ì½”ë“œ (ë¬¸ì œ ìˆìŒ)
ml_dataset = create_ml_dataset(raw_data)  # ê¸°ë³¸ê°’ìœ¼ë¡œ labels í¬í•¨ë¨

# âœ… ìˆ˜ì •ëœ ì½”ë“œ
ml_dataset = create_ml_dataset(raw_data, include_labels=False)  # ëª…ì‹œì ìœ¼ë¡œ ì¶”ë¡ ìš© ì§€ì •
```

### 2. ëª¨ë¸ ì¶”ë¡  ì‹œ ì£¼ì˜
- ì‹¤ì‹œê°„ ì¶”ë¡ ìš© ë°ì´í„°ëŠ” comfort_score ì»¬ëŸ¼ì´ ì—†ìœ¼ë¯€ë¡œ ëª¨ë¸ input shape í™•ì¸ í•„ìš”
- ê¸°ì¡´ ëª¨ë¸ì´ comfort_scoreë¥¼ inputìœ¼ë¡œ ì‚¬ìš©í–ˆë‹¤ë©´ ì¬í•™ìŠµ í•„ìš”

### 3. ëª¨ë‹ˆí„°ë§ í¬ì¸íŠ¸
- ì‹¤ì‹œê°„ ML ë°ì´í„°ì…‹ì— comfort_score ì—†ìŒ í™•ì¸
- í•™ìŠµìš© ML ë°ì´í„°ì…‹ì— comfort_score í¬í•¨ í™•ì¸
- íŒŒì¼ëª… íŒ¨í„´ ì •í™•ì„± í™•ì¸

## ğŸš€ ì ìš© ìƒíƒœ

### ì™„ë£Œëœ ì‘ì—…
- âœ… **Feature Builder ìˆ˜ì •**: `include_labels` íŒŒë¼ë¯¸í„° ì¶”ê°€
- âœ… **ì‹¤ì‹œê°„ ì²˜ë¦¬**: ì¶”ë¡ ìš© ë°ì´í„°ì—ì„œ comfort_score ì œê±°
- âœ… **í•™ìŠµìš© ì²˜ë¦¬**: Rolling Windowì—ì„œ comfort_score í¬í•¨ ìœ ì§€
- âœ… **S3 ì €ì¥**: ìš©ë„ë³„ íŒŒì¼ëª… êµ¬ë¶„ (training_master suffix)

### ì¦‰ì‹œ ì ìš©ë¨
- ë‹¤ìŒ Airflow ì‹¤í–‰ë¶€í„° ì¶”ë¡ ìš© ë°ì´í„°ì—ì„œ comfort_score ì œê±°
- Rolling Window ì—…ë°ì´íŠ¸ ì‹œ í•™ìŠµìš© ë°ì´í„°ì—ëŠ” comfort_score í¬í•¨
- ëª…í™•í•œ íŒŒì¼ëª…ìœ¼ë¡œ ìš©ë„ êµ¬ë¶„

## ğŸ“ FAQ

**Q: ê¸°ì¡´ ëª¨ë¸ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?**
A: ê¸°ì¡´ ëª¨ë¸ì´ comfort_scoreë¥¼ inputìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ë§Œì•½ ì‚¬ìš©í–ˆë‹¤ë©´ ì¬í•™ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.

**Q: comfort_scoreëŠ” ì™„ì „íˆ ì‚¬ë¼ì§€ë‚˜ìš”?**
A: ì•„ë‹™ë‹ˆë‹¤. í•™ìŠµìš© ë°ì´í„°(`training_master`)ì—ëŠ” ì—¬ì „íˆ í¬í•¨ë˜ì–´ ëª¨ë¸ í•™ìŠµì— ì‚¬ìš©ë©ë‹ˆë‹¤. ì‹¤ì‹œê°„ ì¶”ë¡ ìš©ì—ì„œë§Œ ì œê±°ë©ë‹ˆë‹¤.

**Q: íŒŒì¼ëª…ì´ ë³µì¡í•´ì§€ëŠ”ë° ê´œì°®ë‚˜ìš”?**
A: `training_master` suffixë¡œ ëª…í™•íˆ êµ¬ë¶„ë˜ë¯€ë¡œ ìš©ë„ë¥¼ ì‰½ê²Œ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš´ì˜ìƒ í˜¼ë™ì„ ë°©ì§€í•˜ëŠ” íš¨ê³¼ê°€ ë” í½ë‹ˆë‹¤.

---

**ì‘ì„±ì¼**: 2025-09-26
**ì‘ì—…ì**: Claude
**ì˜í–¥ë²”ìœ„**: ì‹¤ì‹œê°„ ML ë°ì´í„° ìƒì„±, S3 ì €ì¥ êµ¬ì¡°
**ìƒíƒœ**: ì™„ë£Œ ë° ë‹¤ìŒ Airflow ì‹¤í–‰ë¶€í„° ì ìš©