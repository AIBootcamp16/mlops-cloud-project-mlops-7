# í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2025-01-27
**íŒŒì¼**: `src/features/feature_builder.py`
**ëª©ì **: ì›ì‹œ ê¸°ìƒ ë°ì´í„°ë¥¼ ML í•™ìŠµìš© í”¼ì²˜ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì • ìƒì„¸ ì„¤ëª…

## ğŸ“Š ë°ì´í„° ë³€í™˜ íë¦„

```
ì›ì‹œ CSV (48ê°œ ì»¬ëŸ¼) â†’ ê¸°ë³¸ í”¼ì²˜ ì¶”ì¶œ (13ê°œ) â†’ í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ (34ê°œ ì´)
```

## ğŸ”„ 1ë‹¨ê³„: ì›ì‹œ ë°ì´í„° â†’ ê¸°ë³¸ í”¼ì²˜

### ì›ì‹œ ë°ì´í„° (`weather_pm10_integrated_full.csv`)
```
YYMMDDHHMI,STN,WD,WS,GST,GST_2,GST_3,PA,PS,PT,PR,TA,TD,HM,PV,RN,RN_2,RN_3,RN_4,SD,SD_2,SD_3,WC,WP,WW,CA,CA_2,CH,CT,CT_2,CT_3,CT_4,VS,SS,SI,ST,TS,TE,TE_2,TE_3,TE_4,ST_2,WH,BF,IR,IX,datetime,PM10,PM10_FLAG
```

### ì¶”ì¶œëœ ê¸°ë³¸ í”¼ì²˜ (13ê°œ)
| ì›ì‹œ ì»¬ëŸ¼ | ML í”¼ì²˜ | ì„¤ëª… | ë³€í™˜ ë¡œì§ |
|----------|---------|------|----------|
| `STN` | `station_id` | ê´€ì¸¡ì†Œ ID | ë¬¸ìì—´ ë³€í™˜ |
| `datetime` | `datetime` | ê´€ì¸¡ ì‹œê°„ | datetime ë³€í™˜ |
| `TA` | `temperature` | ê¸°ì˜¨ (Â°C) | ìˆ«ì ë³€í™˜ |
| `PM10` | `pm10` | ë¯¸ì„¸ë¨¼ì§€ ë†ë„ (Î¼g/mÂ³) | ìˆ«ì ë³€í™˜ |
| `WS` | `wind_speed` | í’ì† (m/s) | ìˆ«ì ë³€í™˜ |
| `HM` | `humidity` | ìƒëŒ€ìŠµë„ (%) | ìˆ«ì ë³€í™˜ |
| `PS` | `pressure` | í˜„ì§€ê¸°ì•• (hPa) | ìˆ«ì ë³€í™˜ |
| `RN` | `rainfall` | ê°•ìˆ˜ëŸ‰ (mm) | ìˆ«ì ë³€í™˜ |
| `WD` | `wind_direction` | í’í–¥ (16ë°©ìœ„) | ìˆ«ì ë³€í™˜ |
| `TD` | `dew_point` | ì´ìŠ¬ì ì˜¨ë„ (Â°C) | ìˆ«ì ë³€í™˜ |
| `CA` | `cloud_amount` | ìš´ëŸ‰ (10ë¶„ìœ„) | ìˆ«ì ë³€í™˜ |
| `VS` | `visibility` | ì‹œì • (m) | ìˆ«ì ë³€í™˜ |
| `SS` | `sunshine` | ì¼ì¡°ì‹œê°„ (hr) | ìˆ«ì ë³€í™˜ |

## ğŸ› ï¸ 2ë‹¨ê³„: í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ (`add_engineered_features`)

### A. ì‹œê°„ ê¸°ë°˜ í”¼ì²˜ (8ê°œ)

| í”¼ì²˜ëª… | ë°ì´í„° íƒ€ì… | ìƒì„± ë¡œì§ | ì˜ˆì‹œ |
|--------|-------------|----------|------|
| `hour` | int | `datetime.hour` | 9 |
| `day_of_week` | int | `datetime.dayofweek` (0=ì›”, 6=ì¼) | 0 |
| `month` | int | `datetime.month` | 1 |
| `is_rush_hour` | bool | `hour in [7,8,9,18,19,20]` | True |
| `is_morning_rush` | bool | `hour in [7,8,9]` | True |
| `is_evening_rush` | bool | `hour in [18,19,20]` | False |
| `is_weekday` | bool | `day_of_week < 5` | True |
| `is_weekend` | bool | `day_of_week >= 5` | False |
| `season` | str | ì›” ê¸°ì¤€ ê³„ì ˆ ë§¤í•‘ | 'winter' |

### B. ê¸°ì˜¨ ê¸°ë°˜ í”¼ì²˜ (5ê°œ)

| í”¼ì²˜ëª… | ë°ì´í„° íƒ€ì… | ìƒì„± ë¡œì§ | ì˜ˆì‹œ |
|--------|-------------|----------|------|
| `temp_category` | str | ì˜¨ë„ êµ¬ê°„ ë¶„ë¥˜ | 'very_cold' (-2.5Â°C) |
| `temp_comfort` | float | `20 - abs(temp - 20)` | -2.5 |
| `temp_extreme` | bool | `temp < 0 or temp > 30` | True |
| `heating_needed` | bool | `temp < 10` | True |
| `cooling_needed` | bool | `temp > 25` | False |

**ì˜¨ë„ êµ¬ê°„ ë¶„ë¥˜:**
- `very_cold`: < 0Â°C
- `cold`: 0-10Â°C
- `mild`: 10-20Â°C
- `warm`: 20-30Â°C
- `hot`: > 30Â°C

### C. ì§€ì—­ ê¸°ë°˜ í”¼ì²˜ (3ê°œ)

| í”¼ì²˜ëª… | ë°ì´í„° íƒ€ì… | ìƒì„± ë¡œì§ | ì˜ˆì‹œ |
|--------|-------------|----------|------|
| `is_metro_area` | bool | `station_id in ì£¼ìš”ë„ì‹œë¦¬ìŠ¤íŠ¸` | True |
| `is_coastal` | bool | `station_id in ì—°ì•ˆì§€ì—­ë¦¬ìŠ¤íŠ¸` | False |
| `region` | str | ê´€ì¸¡ì†Œ ë²ˆí˜¸ ì²«ìë¦¬ ê¸°ì¤€ ê¶Œì—­ | 'central' |

**ê¶Œì—­ ë¶„ë¥˜:**
- `central`: 100ë²ˆëŒ€ (ì¤‘ë¶€ê¶Œ)
- `south`: 200ë²ˆëŒ€ (ë‚¨ë¶€ê¶Œ)
- `east`: 300ë²ˆëŒ€ (ë™ë¶€ê¶Œ)
- `west`: 900ë²ˆëŒ€ (ì„œë¶€ê¶Œ)

### D. ëŒ€ê¸°ì§ˆ ê¸°ë°˜ í”¼ì²˜ (3ê°œ)

| í”¼ì²˜ëª… | ë°ì´í„° íƒ€ì… | ìƒì„± ë¡œì§ | ì˜ˆì‹œ |
|--------|-------------|----------|------|
| `pm10_grade` | str | í™˜ê²½ë¶€ ë¯¸ì„¸ë¨¼ì§€ ë“±ê¸‰ ê¸°ì¤€ | 'good' |
| `mask_needed` | bool | `pm10 > 50` | False |
| `outdoor_activity_ok` | bool | `pm10 <= 80` | True |

**ë¯¸ì„¸ë¨¼ì§€ ë“±ê¸‰:**
- `good`: 0-30 Î¼g/mÂ³
- `moderate`: 31-80 Î¼g/mÂ³
- `unhealthy`: 81-150 Î¼g/mÂ³
- `very_unhealthy`: > 150 Î¼g/mÂ³

### E. ì¢…í•© ì¾Œì ì§€ìˆ˜ (1ê°œ)

| í”¼ì²˜ëª… | ë°ì´í„° íƒ€ì… | ìƒì„± ë¡œì§ | ì˜ˆì‹œ |
|--------|-------------|----------|------|
| `comfort_score` | float | ê¸°ì˜¨(50%) + ë¯¸ì„¸ë¨¼ì§€(30%) + ë³´ì •ì ìˆ˜ | 18.0 |

**ì¾Œì ì§€ìˆ˜ ê³„ì‚° ê³µì‹:**
```python
# ê¸°ë³¸ ì ìˆ˜ 50ì ì—ì„œ ì‹œì‘
base_score = 50.0

# ê¸°ì˜¨ ì ìˆ˜ (50% ë¹„ì¤‘)
if 15 <= temp <= 22: temp_score = 90  # ìµœì 
elif 10 <= temp <= 25: temp_score = 70  # ì ë‹¹
elif 5 <= temp <= 30: temp_score = 50   # ê²¬ë”œë§Œ
elif 0 <= temp <= 35: temp_score = 20   # ë¶ˆì¾Œ
else: temp_score = 10  # ê·¹í•œ

# ë¯¸ì„¸ë¨¼ì§€ ì ìˆ˜ (30% ë¹„ì¤‘)
if pm10 <= 15: pm10_score = 90      # ë§¤ìš° ì¢‹ìŒ
elif pm10 <= 35: pm10_score = 70    # ì¢‹ìŒ
elif pm10 <= 75: pm10_score = 50    # ë³´í†µ
elif pm10 <= 150: pm10_score = 30   # ë‚˜ì¨
else: pm10_score = 10               # ë§¤ìš° ë‚˜ì¨

# ìµœì¢… ì ìˆ˜ ê³„ì‚°
comfort_score = base_score * 0.5 + temp_score * 0.5
comfort_score = comfort_score * 0.7 + pm10_score * 0.3

# ë³´ì • ì ìš©
comfort_score -= (is_rush_hour * 10)    # ì¶œí‡´ê·¼ì‹œê°„ -10ì 
comfort_score += (is_weekend * 5)       # ì£¼ë§ +5ì 
comfort_score -= (temp_extreme * 20)    # ê·¹í•œê¸°ì˜¨ -20ì 

# 0-100 ë²”ìœ„ë¡œ ì œí•œ
comfort_score = clip(comfort_score, 0, 100)
```

## ğŸ“‹ ìµœì¢… ML ë°ì´í„°ì…‹ ìŠ¤í‚¤ë§ˆ

**ì´ 34ê°œ í”¼ì²˜:**

| ì¹´í…Œê³ ë¦¬ | í”¼ì²˜ ìˆ˜ | í”¼ì²˜ ë¦¬ìŠ¤íŠ¸ |
|----------|---------|-------------|
| **ê¸°ë³¸ ì •ë³´** | 2 | `station_id`, `datetime` |
| **ì›ì‹œ ê¸°ìƒ** | 11 | `temperature`, `pm10`, `wind_speed`, `humidity`, `pressure`, `rainfall`, `wind_direction`, `dew_point`, `cloud_amount`, `visibility`, `sunshine` |
| **ì‹œê°„ í”¼ì²˜** | 8 | `hour`, `day_of_week`, `month`, `is_rush_hour`, `is_morning_rush`, `is_evening_rush`, `is_weekday`, `is_weekend`, `season` |
| **ì˜¨ë„ í”¼ì²˜** | 5 | `temp_category`, `temp_comfort`, `temp_extreme`, `heating_needed`, `cooling_needed` |
| **ì§€ì—­ í”¼ì²˜** | 3 | `is_metro_area`, `is_coastal`, `region` |
| **ëŒ€ê¸°ì§ˆ í”¼ì²˜** | 3 | `pm10_grade`, `mask_needed`, `outdoor_activity_ok` |
| **ì¢…í•© ì§€ìˆ˜** | 1 | `comfort_score` |

## ğŸ¯ í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ ëª©ì 

1. **ì‹œê°„ íŒ¨í„´ í¬ì°©**: ì¶œí‡´ê·¼ì‹œê°„, ê³„ì ˆì„±, ìš”ì¼ íŒ¨í„´
2. **ì§€ì—­ íŠ¹ì„± ë°˜ì˜**: ë„ì‹œ/ì—°ì•ˆ ì§€ì—­ êµ¬ë¶„, ê¶Œì—­ë³„ íŠ¹ì„±
3. **ì‹¤ìš©ì  ì§€í‘œ ìƒì„±**: ë§ˆìŠ¤í¬ í•„ìš”ì„±, ì•¼ì™¸í™œë™ ì í•©ë„
4. **ì¢…í•© í‰ê°€**: ë‹¤ì–‘í•œ ê¸°ìƒ ìš”ì†Œë¥¼ í†µí•©í•œ ì¾Œì ì§€ìˆ˜

## ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸

- **ê¸°ì˜¨**ì´ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œ (ì¾Œì ì§€ìˆ˜ 50% ë¹„ì¤‘)
- **ë¯¸ì„¸ë¨¼ì§€**ê°€ ë‘ ë²ˆì§¸ ì¤‘ìš” ìš”ì†Œ (30% ë¹„ì¤‘)
- **ì¶œí‡´ê·¼ì‹œê°„**ì€ ë¶ˆí¸í•¨ì„ ê°€ì¤‘ì‹œí‚¤ëŠ” ìš”ì†Œ (-10ì )
- **ì£¼ë§**ì€ ì¾Œì í•¨ì„ ë†’ì´ëŠ” ìš”ì†Œ (+5ì )
- **ê·¹í•œ ê¸°ì˜¨**ì€ ì¾Œì ë„ë¥¼ í¬ê²Œ ë–¨ì–´ëœ¨ë¦¼ (-20ì )

## ğŸ” ì‹¤ì œ ë°ì´í„° ë³€í™˜ ì˜ˆì‹œ

### ì›ì‹œ ë°ì´í„° 1í–‰:
```
202401010900,100,9,0.8,-9,-9.0,-9,936.9,1031.7,2,1.1,-2.5,-3.3,94.0,4.8,0.0,0.0,0.0,-9.0,-9.0,-9.0,18.7,-9,-9,-,8,8,5,-,-9,-9,-9,1328,0.0,0.01,-9,-1.5,-99.0,-99.0,-99.0,-99.0,-9,-9.0,-9,3,-9,2024-01-01 09:00:00,15.0,000000
```

### ë³€í™˜ëœ ML í”¼ì²˜:
```python
{
    # ê¸°ë³¸ ì •ë³´
    'station_id': '100',
    'datetime': '2024-01-01 09:00:00',

    # ì›ì‹œ ê¸°ìƒ ë°ì´í„°
    'temperature': -2.5,        # TA ì»¬ëŸ¼
    'pm10': 15.0,              # PM10 ì»¬ëŸ¼
    'wind_speed': 0.8,         # WS ì»¬ëŸ¼
    'humidity': 94.0,          # HM ì»¬ëŸ¼
    'pressure': 936.9,         # PS ì»¬ëŸ¼
    'rainfall': 0.0,           # RN ì»¬ëŸ¼
    'wind_direction': 9.0,     # WD ì»¬ëŸ¼
    'dew_point': -3.3,         # TD ì»¬ëŸ¼
    'cloud_amount': 8.0,       # CA ì»¬ëŸ¼
    'visibility': 1328.0,      # VS ì»¬ëŸ¼
    'sunshine': 0.0,           # SS ì»¬ëŸ¼

    # ì‹œê°„ í”¼ì²˜
    'hour': 9,                 # 09ì‹œ
    'day_of_week': 0,          # ì›”ìš”ì¼
    'month': 1,                # 1ì›”
    'is_rush_hour': True,      # 9ì‹œëŠ” ì¶œí‡´ê·¼ì‹œê°„
    'is_morning_rush': True,   # ì•„ì¹¨ ì¶œí‡´ê·¼
    'is_evening_rush': False,  # ì €ë… ì¶œí‡´ê·¼ ì•„ë‹˜
    'is_weekday': True,        # í‰ì¼
    'is_weekend': False,       # ì£¼ë§ ì•„ë‹˜
    'season': 'winter',        # 1ì›” = ê²¨ìš¸

    # ì˜¨ë„ í”¼ì²˜
    'temp_category': 'very_cold',  # -2.5Â°C < 0
    'temp_comfort': -2.5,          # 20 - |-2.5 - 20| = -2.5
    'temp_extreme': True,          # -2.5 < 0
    'heating_needed': True,        # -2.5 < 10
    'cooling_needed': False,       # -2.5 < 25

    # ì§€ì—­ í”¼ì²˜
    'is_metro_area': True,     # 100ë²ˆ = ì„œìš¸ (ì£¼ìš”ë„ì‹œ)
    'is_coastal': False,       # 100ë²ˆ â‰  ì—°ì•ˆì§€ì—­
    'region': 'central',       # 100ë²ˆëŒ€ = ì¤‘ë¶€ê¶Œ

    # ëŒ€ê¸°ì§ˆ í”¼ì²˜
    'pm10_grade': 'good',      # 15.0 â‰¤ 30 (ì¢‹ìŒ)
    'mask_needed': False,      # 15.0 â‰¤ 50
    'outdoor_activity_ok': True, # 15.0 â‰¤ 80

    # ì¢…í•© ì§€ìˆ˜
    'comfort_score': 18.0      # ê³„ì‚° ê³¼ì •ì€ ì•„ë˜ ì°¸ì¡°
}
```

### ì¾Œì ì§€ìˆ˜ ê³„ì‚° ê³¼ì • (ìƒì„¸):

```python
# 1ë‹¨ê³„: ê¸°ë³¸ ì ìˆ˜
base_score = 50.0

# 2ë‹¨ê³„: ê¸°ì˜¨ ì ìˆ˜ (-2.5Â°C)
temp_score = 10  # -2.5 < 0 (ê·¹í•œ ì˜¨ë„)

# 3ë‹¨ê³„: ê¸°ì˜¨ ë°˜ì˜ (50% ë¹„ì¤‘)
score = base_score * 0.5 + temp_score * 0.5
score = 50 * 0.5 + 10 * 0.5 = 30.0

# 4ë‹¨ê³„: ë¯¸ì„¸ë¨¼ì§€ ì ìˆ˜ (15.0 Î¼g/mÂ³)
pm10_score = 90  # 15.0 â‰¤ 15 (ë§¤ìš° ì¢‹ìŒ)

# 5ë‹¨ê³„: ë¯¸ì„¸ë¨¼ì§€ ë°˜ì˜ (30% ë¹„ì¤‘)
score = score * 0.7 + pm10_score * 0.3
score = 30 * 0.7 + 90 * 0.3 = 21 + 27 = 48.0

# 6ë‹¨ê³„: ë³´ì • ì ìš©
score -= (True * 10)    # ì¶œí‡´ê·¼ì‹œê°„ -10ì  = 38.0
score += (False * 5)    # ì£¼ë§ ì•„ë‹˜ +0ì  = 38.0
score -= (True * 20)    # ê·¹í•œê¸°ì˜¨ -20ì  = 18.0

# 7ë‹¨ê³„: ë²”ìœ„ ì œí•œ (0-100)
final_score = max(0, min(100, 18.0)) = 18.0
```

## ğŸ› ï¸ ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì£¼ìš” í•¨ìˆ˜

### 1. `create_ml_dataset()` - ë©”ì¸ ë³€í™˜ í•¨ìˆ˜
```python
# ìœ„ì¹˜: src/features/feature_builder.py:10-155
# ì—­í• : ì›ì‹œ ë°ì´í„°ë¥¼ ë°›ì•„ ê¸°ë³¸ í”¼ì²˜ ì¶”ì¶œ í›„ ì—”ì§€ë‹ˆì–´ë§ ì ìš©
raw_data = {...}  # ì›ì‹œ ë°ì´í„°
ml_dataset = create_ml_dataset(raw_data)
```

### 2. `add_engineered_features()` - í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§
```python
# ìœ„ì¹˜: src/features/feature_builder.py:157-249
# ì—­í• : ê¸°ë³¸ í”¼ì²˜ë¥¼ ë°›ì•„ 21ê°œ ì—”ì§€ë‹ˆì–´ë§ í”¼ì²˜ ì¶”ê°€
basic_df = pd.DataFrame(...)
enhanced_df = add_engineered_features(basic_df)
```

### 3. `calculate_comfort_score()` - ì¾Œì ì§€ìˆ˜ ê³„ì‚°
```python
# ìœ„ì¹˜: src/features/feature_builder.py:252-296
# ì—­í• : ê¸°ìƒ ì¡°ê±´ì„ ì¢…í•©í•˜ì—¬ 0-100ì  ì¾Œì ì§€ìˆ˜ ê³„ì‚°
scores = calculate_comfort_score(df)
```

## ğŸ”§ ê°œë°œìë¥¼ ìœ„í•œ ì°¸ê³ ì‚¬í•­

### í”¼ì²˜ ì¶”ê°€ ì‹œ ê³ ë ¤ì‚¬í•­:
1. **ê²°ì¸¡ì¹˜ ì²˜ë¦¬**: `-9`, `-99`, `-999` ë“±ì€ ê²°ì¸¡ì¹˜ë¡œ ì²˜ë¦¬
2. **ë°ì´í„° íƒ€ì…**: ë²”ì£¼í˜•/ìˆ˜ì¹˜í˜• êµ¬ë¶„í•˜ì—¬ ì ì ˆí•œ ë³€í™˜ ì ìš©
3. **ìŠ¤ì¼€ì¼ë§**: ìˆ˜ì¹˜í˜• í”¼ì²˜ëŠ” ë²”ìœ„ê°€ ë‹¤ë¥´ë¯€ë¡œ ì •ê·œí™” ê³ ë ¤
4. **ìƒê´€ê´€ê³„**: ìƒˆ í”¼ì²˜ê°€ ê¸°ì¡´ í”¼ì²˜ì™€ ë†’ì€ ìƒê´€ê´€ê³„ê°€ ì—†ëŠ”ì§€ í™•ì¸

### ì„±ëŠ¥ ìµœì í™”:
- `pd.cut()` ì‚¬ìš©ìœ¼ë¡œ êµ¬ê°„ ë¶„ë¥˜ íš¨ìœ¨í™”
- `map()` í•¨ìˆ˜ë¡œ ì¡°ê±´ë¶€ ë³€í™˜ ë²¡í„°í™”
- `isin()` ë©”ì„œë“œë¡œ ë©¤ë²„ì‹­ í…ŒìŠ¤íŠ¸ ìµœì í™”